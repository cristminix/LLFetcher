import{o as l,c as i,s as d}from"./index-l-FjSNo0.js";const u=o=>new Promise(t=>{if(document.querySelector(o))return t(document.querySelector(o));const n=new MutationObserver(e=>{document.querySelector(o)&&(t(document.querySelector(o)),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})});class m{constructor(){this.initController()}initController(){l((t,n)=>{switch(t.name){case"cmd.getCourseInfo":this.onCommand(t.name);break;case"cmd.addCourseLegacy":this.onCommand(t.name,t.data);break;case"cmd.getCourseSections":this.onCommand(t.name,t.data);break;case"cmd.getCourseToc":this.onCommand(t.name,t.data);break;case"cmd.getCookie":this.onCommand(t.name,t.data);break;case"cmd.isLogin":this.onCommand(t.name,t.data);break;case"cmd.validCoursePage":case"cmd.validCoursePageAuto":this.onCommand(t.name);break;case"console.log":t.data.map(e=>console.log(e));break;default:this.onCommand(t.name,t.data);break}}),this.waitForCheckerElm()}getExecuteBtn(){return document.getElementById("exec-button")}getInputScriptEl(){return document.getElementById("input-script")}getInputScriptCaller(){return document.getElementById("input-script-caller")}setInputScriptCaller(t){return this.getInputScriptCaller().value=t}getOutputScriptEl(){return document.getElementById("output-script")}setOutputScriptContent(t){this.getOutputScriptEl().value=t}setInputScriptContent(t){this.getInputScriptEl().value=JSON.stringify(t)}createRandCls(){const t=new Date().getTime().toString();return`os-${i.crc32(t).toString(16)}`}executeScriptContent(t,n,e="popup"){try{t.ocls||(t.ocls=this.createRandCls()),this.setInputScriptCaller(e),this.setInputScriptContent(t),this.getExecuteBtn().click(),this.waitForScriptOutput(t.ocls,n,e)}catch(c){console.error(c)}}async executeTopScript(t,n){return new Promise((e,c)=>{const r={ocls:this.createRandCls(),cmd:t,param:n},s="content";try{this.setInputScriptCaller(s),this.setInputScriptContent(r),this.getExecuteBtn().click(),this.waitForScriptOutput(r.ocls,a=>{e(a)},s)}catch(a){console.error(a),c(a)}})}waitForScriptOutput(t,n,e="popup"){u(`.${t}`).then(c=>{const r=JSON.parse(c.value);n(r)})}waitForCheckerElm(){u(".course-checker-last").then(t=>{t&&(t.setAttribute("class","_blank"),setTimeout(()=>{this.onCommand("cmd.validCoursePageAuto"),this.waitForCheckerElm()},3e3))})}createRandCls(){const t=new Date().getTime().toString();return`os-${i.crc32(t).toString(16)}`}onCommand(t,n){const e=t.replace(/^cmd\./,""),c=this.createRandCls(),r={cmd:e,ocls:c,param:n};this.executeScriptContent(r,s=>{d(`${t}`,s,"popup")})}}const p=(o,t,n=c=>c,e=c=>c)=>{let c=document.getElementsByTagName(t)[0],r=document.createElement("script");r.addEventListener("load",()=>{console.log(`${r.src} loaded`),n(r)}),r.addEventListener("error",s=>{console.log("Error on loading file",s),e(s)}),r.setAttribute("type","text/javascript"),r.setAttribute("src",o),c.appendChild(r)},C=async o=>new Promise((t,n)=>{p(chrome.runtime.getURL(o),"body",e=>{t(e)},e=>{n(e)})}),g=async()=>{await C("src/content-pages/dist/content-inject.js"),window.contentScript=new m};g();
