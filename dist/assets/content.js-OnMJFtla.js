import{o as d,c as i,s as l}from"./index-1JXFPcb5.js";const u=r=>new Promise(t=>{if(document.querySelector(r))return t(document.querySelector(r));const e=new MutationObserver(o=>{document.querySelector(r)&&(t(document.querySelector(r)),e.disconnect())});e.observe(document.body,{childList:!0,subtree:!0})});class m{constructor(){this.initController()}initController(){d((t,e)=>{switch(t.name){case"cmd.getCourseInfo":this.onCommand(t.name);break;case"cmd.addCourseLegacy":this.onCommand(t.name,t.data);break;case"cmd.getCourseSections":this.onCommand(t.name,t.data);break;case"cmd.getCourseToc":this.onCommand(t.name,t.data);break;case"cmd.getCookie":this.onCommand(t.name,t.data);break;case"cmd.isLogin":this.onCommand(t.name,t.data);break;case"cmd.validCoursePage":case"cmd.validCoursePageAuto":this.onCommand(t.name);break;case"console.log":t.data.map(o=>console.log(o));break;default:this.onCommand(t.name,t.data);break}}),this.waitForCheckerElm()}getExecuteBtn(){return document.getElementById("exec-button")}getInputScriptEl(){return document.getElementById("input-script")}getInputScriptCaller(){return document.getElementById("input-script-caller")}setInputScriptCaller(t){return this.getInputScriptCaller().value=t}getOutputScriptEl(){return document.getElementById("output-script")}setOutputScriptContent(t){this.getOutputScriptEl().value=t}setInputScriptContent(t){this.getInputScriptEl().value=JSON.stringify(t)}createRandCls(){const t=new Date().getTime().toString();return`os-${i.crc32(t).toString(16)}`}executeScriptContent(t,e,o="popup"){try{t.ocls||(t.ocls=this.createRandCls()),this.setInputScriptCaller(o),this.setInputScriptContent(t),this.getExecuteBtn().click(),this.waitForScriptOutput(t.ocls,e,o)}catch(n){console.error(n)}}async executeTopScript(t,e){return new Promise((o,n)=>{const c={ocls:this.createRandCls(),cmd:t,param:e},s="content";try{this.setInputScriptCaller(s),this.setInputScriptContent(c),this.getExecuteBtn().click(),this.waitForScriptOutput(c.ocls,a=>{o(a)},s)}catch(a){console.error(a),n(a)}})}waitForScriptOutput(t,e,o="popup"){u(`.${t}`).then(n=>{const c=JSON.parse(n.value);e(c)})}waitForCheckerElm(){u(".course-checker-last").then(t=>{t&&(t.setAttribute("class","_blank"),setTimeout(()=>{this.onCommand("cmd.validCoursePageAuto"),this.waitForCheckerElm()},3e3))})}createRandCls(){const t=new Date().getTime().toString();return`os-${i.crc32(t).toString(16)}`}onCommand(t,e){const o=t.replace(/^cmd\./,""),n=this.createRandCls(),c={cmd:o,ocls:n,param:e};this.executeScriptContent(c,s=>{l(`${t}`,s,"popup")})}}const p=(r,t,e=n=>n,o=n=>n)=>{let n=document.getElementsByTagName(t)[0],c=document.createElement("script");c.addEventListener("load",()=>{console.log(`${c.src} loaded`),e(c)}),c.addEventListener("error",s=>{console.log("Error on loading file",s),o(s)}),c.setAttribute("type","text/javascript"),c.setAttribute("src",r),n.appendChild(c)},g=async(r,t=e=>e)=>new Promise((e,o)=>{p(chrome.runtime.getURL(r),"body",n=>{typeof t=="function"&&t(),e(n)},n=>{o(n)})}),C=async()=>{window.contentScript=new m,await g("src/content-pages/dist/content-inject.js",()=>{setTimeout(()=>{window.contentScript.executeTopScript("getCookie").then(r=>{console.log(r),l("content.cookie.set",{cookies:r},"background",t=>{console.log(t)})})},1e3)})};C();
