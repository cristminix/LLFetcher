const i=t=>new Promise(e=>{if(document.querySelector(t))return e(document.querySelector(t));const n=new MutationObserver(o=>{document.querySelector(t)&&(e(document.querySelector(t)),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})}),a=(t,e=null)=>({name:t,data:e}),u=(t,e,n="popup",o=r=>r)=>{const r=a(t,e);chrome.runtime.sendMessage(r,o)},m=t=>{chrome.runtime.onMessage.addListener((e,n)=>{t(e,n)})},l=(t,e,n=r=>r,o=r=>r)=>{let r=document.getElementsByTagName(e)[0],c=document.createElement("script");c.addEventListener("load",()=>{console.log(`${c.src} loaded`),n(c)}),c.addEventListener("error",s=>{console.log("Error on loading file",s),o(s)}),c.setAttribute("type","text/javascript"),c.setAttribute("src",t),r.appendChild(c)},d=async t=>new Promise((e,n)=>{l(chrome.runtime.getURL(t),"body",o=>{e(o)},o=>{n(o)})});class p{constructor(){this.initController()}initController(){m((e,n)=>{switch(e.name){case"cmd.getCourseInfo":this.onCommand(e.name);break;case"cmd.getCourseSections":this.onCommand(e.name,e.data);break;case"cmd.getCourseToc":this.onCommand(e.name,e.data);break;case"cmd.validCoursePage":case"cmd.validCoursePageAuto":this.onCommand(e.name);break;case"console.log":e.data.map(o=>console.log(o));break}}),this.waitForCheckerElm()}getExecuteBtn(){return document.getElementById("exec-button")}getInputScriptEl(){return document.getElementById("input-script")}getOutputScriptEl(){return document.getElementById("output-script")}setInputScriptContent(e){this.getInputScriptEl().value=JSON.stringify(e)}executeScriptContent(e,n){try{this.setInputScriptContent(e),this.getExecuteBtn().click(),this.waitForScriptOutput(e.ocls,n)}catch{}}waitForScriptOutput(e,n){i(`.${e}`).then(o=>{const r=JSON.parse(o.value);n(r)})}waitForCheckerElm(){i(".course-checker-last").then(e=>{e&&(e.setAttribute("class","_blank"),setTimeout(()=>{this.onCommand("cmd.validCoursePageAuto"),this.waitForCheckerElm()},3e3))})}onCommand(e,n){const o=e.replace(/^cmd\./,""),r=`ocls-${new Date().getTime()}`,c={cmd:o,ocls:r,param:n};this.executeScriptContent(c,s=>{u(`${e}`,s)})}}const g=async()=>{const t=["lib/jquery.min.js","lib/underscore.min.js","lib/learning.js","lib/react.development.js","lib/react-dom.development.js","lib/app.js"];for(let e in t){const n=t[e];await d(n)}new p};g();
