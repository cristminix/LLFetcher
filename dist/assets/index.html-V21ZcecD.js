var F=Object.defineProperty;var P=(a,n,e)=>n in a?F(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var d=(a,n,e)=>(P(a,typeof n!="symbol"?n+"":n,e),e);import{r as U,c as $,j as s,a as O,B as M,A as I,C as B,u as E,b as _,d as V,e as q,R as z,f as j,S as Y,g as D,h as H,i as W}from"./font-awesome.min-0wTPF2mD.js";import{s as K,a as Q,g as G}from"./index-1JXFPcb5.js";class J extends U.Component{constructor(){super(...arguments);d(this,"commandListener",(e,t)=>{this.onMessageCommand(e,t)})}async sendMessageAsync(e,t,o="content"){return new Promise((l,u)=>{chrome||u("running_in_dev_mode"),chrome.runtime||u("running_in_dev_mode");const r=(i,m)=>{chrome.runtime.onMessage.removeListener(r),l([i,m])};try{chrome.runtime.onMessage.addListener(r),K(e,t,o)}catch(i){u(i)}})}async getFromMessage(e,t,o){const[l,u]=await this.sendMessageAsync(e,t,o);return l.name===e?l.data:null}async onMessageCommand(e,t){}onMessage(){if(chrome&&chrome.runtime)try{chrome.runtime.onMessage.removeListener(this.commandListener),chrome.runtime.onMessage.addListener(this.commandListener)}catch(e){console.log(e)}}initMessaging(){this.onMessage()}}const T="src/option-pages/",X=async()=>new Promise((a,n)=>{try{chrome.tabs.query({currentWindow:!0,active:!0},function(e){a(e[0])})}catch{a(null)}}),v=async()=>{const a=await X();return a?a.url:""},Z=a=>a.match("youtube.com"),w=(a,n=null)=>{let t=`${chrome.runtime.getURL(`${T}options.html`)}${a}`;if(typeof n=="object"){let o=[];Object.keys(n).map((l,u)=>{let r=n[l];typeof r=="boolean"&&(r=r?"1":"0");const i=`${l}=${r}`;o.push(i)}),t=`${t}?${o.join("&")}`}return t},S=async a=>{(await chrome.tabs.query({url:`${a}*`})).length>0?chrome.runtime.sendMessage({action:"activateTab",url:a,optionPageBaseUrl:T}):chrome.tabs.create({url:a})};class k extends J{constructor(e){super(e);d(this,"mApp",null);d(this,"mCourse",null);d(this,"mAuthor",null);d(this,"mSection",null);d(this,"mToc",null);d(this,"store",null);d(this,"courseAuthors",[]);const{store:t}=e;this.store=t,this.mApp=t.get("App"),this.mCourse=t.get("Course"),this.mAuthor=t.get("Author"),this.mSection=t.get("Section"),this.mToc=t.get("Toc"),this.mPrxCache=t.get("PrxCache"),this.state={greeting:"LLFetcher 3.0+",lastCourseList:{},fetchBtnState:0,loading:!1,courseInfo:null,validCoursePage:!1,disableFetchBtn:!1,isLogin:!1,legacyMode:!1,blockMainContent:!1,isYoutube:!1}}async addToLastCourseList(e){this.setState({courseInfo:e});const t=e.slug,o=await this.createCourse(e);Object.keys(this.state.lastCourseList).includes(t)||this.populateLastCourseList(),await this.props.onSelectCourse(o,this.courseAuthors)}onMessageCommand(e,t){e.name==="cmd.validCoursePageAuto"&&this.setState({validCoursePage:e.data})}populateLastCourseList(){const e=this.mCourse.getList();let t={};for(let o in e)t[e[o].slug]=e[o];this.setState({lastCourseList:t})}async componentDidMount(){const e=await v();Z(e)?this.setState({isYoutube:!0}):(this.populateLastCourseList(),this.initMessaging(),await this.getValidCourseMessage())}async getValidCourseMessage(){const t=await this.getFromMessage("cmd.validCoursePage");this.setState({validCoursePage:t})}async insertCourseLegacyM3Rec(e,t){await this.mPrxCache.set(e,t,200),await this.activateAddCourseOptionTab(e,!0)}async insertCourseLegacy(e,t){if(e){const{title:o,slug:l,duration:u,sourceCodeRepository:r,description:i,urn:m}=e,p=await this.mCourse.create(o,l,u,r,i,m);if(p){console.log(p);const x=p.id;if(Array.isArray(t))for(const h of t){const C=[],f=Q(h.title),c=await this.mSection.create(h.title,f,x,C);if(c){if(console.log(c),Array.isArray(h.items))for(const g of h.items){const y=c.id,b=null,N=null,R=$(`${e.slug}/${g.slug}`),L=await this.mToc.create(g.title,g.slug,R,g.duration,null,null,y,b,N);L?console.log(L):console.error("failed to create toc")}}else console.error("failed to create section")}}else console.error("failed to create course")}}async addCourseLegacy(e){this.setState({blockMainContent:!0});const o=await this.getFromMessage("cmd.getM3Rec",e);this.insertCourseLegacyM3Rec(e,o),this.setState({blockMainContent:!1})}async getIsLoginMessage(){const t=await this.getFromMessage("cmd.isLogin");this.seState({isLogin:t})}async getCourseInfoMessage(){const e="cmd.getCourseInfo";this.setState({fetchBtnState:1});const t=await this.getFromMessage(e);await this.addToLastCourseList(t)}async activateAddCourseOptionTab(e,t=!1){const o=w(`#/course/add/${e}`,{useM3Rec:t});await S(o)}async addCourseFromCurrentUrl(){const t=(await v()).replace("https://www.linkedin.com/learning/","").split("/")[0],{legacyMode:o}=this.state;o?this.addCourseLegacy(t):this.activateAddCourseOptionTab(t)}async onSelectCourse(e){this.activateAddCourseOptionTab(e)}onLegacyModeChanged(e){this.setState({legacyMode:e})}async analizeVideo(){const e=await v(),t=G(e),o=w("#/developer/video-analizer",t);await S(o)}render(){const{isYoutube:e,blockMainContent:t,legacyMode:o,isLogin:l,greeting:u,lastCourseList:r,fetchBtnState:i,validCoursePage:m,loading:p,disableFetchBtn:x}=this.state,h=Object.keys(r),C=i==0?"fa-plus":i==1?"fa-spin fa-spinner":i==2?"fa-refresh":"fa-hand-o-right",f=h.map(c=>{const g=r[c],y=g.slug,b=g.title;return{value:y,text:b}});return s.jsxs("div",{className:"relative",children:[t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute top-0 start-0 w-full h-full bg-white/[.5] rounded-lg dark:bg-gray-800/[.4]"}),s.jsx("div",{className:"absolute top-1/2 start-1/2 transform -translate-x-1/2 -translate-y-1/2",children:s.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-[3px] border-current border-t-transparent text-blue-600 rounded-full dark:text-blue-500",role:"status","aria-label":"loading",children:s.jsx("span",{className:"sr-only",children:"Loading..."})})})]}):null,s.jsxs("div",{className:"welcome-page page gap-2 flex flex-col items-center pt-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:s.jsx("img",{src:O})}),s.jsx("div",{children:s.jsx("p",{className:"font-bold pt-2 pb-4 text-center text-lg",style:{fontFamily:"Monoton, cursive"},children:u})})]}),e?s.jsx(s.Fragment,{children:s.jsx("div",{className:"action-cnt w-full flex gap-2 items-center",children:s.jsx(M,{caption:"Analize Video",onClick:c=>this.analizeVideo(),icon:"fa fa-youtube"})})}):null,s.jsxs("div",{className:"action-cnt w-full",children:[f.length>0?s.jsx(s.Fragment,{children:s.jsx(I,{data:f,label:"Load Last Course",onSelect:c=>this.onSelectCourse(c)})}):"",m?s.jsxs("div",{className:"btn-cnt text-center flex gap-2 p-2",children:[s.jsx(B,{label:"Legacy Mode",className:"pt-2",checked:o,onChange:c=>this.onLegacyModeChanged(c)}),s.jsx(M,{disabled:i==1||!m||x,className:"mx-auto btn btn-primary",onClick:c=>this.addCourseFromCurrentUrl(),icon:`fa ${C}`,caption:"Add This Course"})]}):""]})]})]})}}const ee=({store:a,config:n})=>{const e=E();return s.jsx("div",{className:"app-container w-[300px] py-4 px-2 dark:bg-gray-700 dark:text-gray-200",children:e||s.jsx(k,{store:a,config:n})})};function te(){const a=_();console.error(a);const n=e=>{if(e)return e.toString().split("").map((t,o)=>s.jsx("i",{className:`bi bi-${t}-square`},o))};return s.jsxs("div",{id:"error-page",className:"dark:text-slate-500 p-4 text-center",children:[s.jsx("h1",{children:"Oops!"}),s.jsx("p",{children:"Sorry, an unexpected error has occurred."}),s.jsx("p",{children:s.jsx("i",{children:a.statusText||a.message})}),s.jsx("p",{children:n(a.status)})]})}const se=()=>s.jsx("div",{children:s.jsx("h1",{children:"NativeClientHttp"})});function ae({config:a,store:n}){const e=V(q(s.jsxs(j,{path:"/",errorElement:s.jsx(te,{}),element:s.jsx(ee,{config:a,store:n}),children:[s.jsx(j,{path:"/welcome",element:s.jsx(k,{store:n,config:a})}),s.jsx(j,{path:"/native-client-http",element:s.jsx(se,{store:n,config:a})})]})));return s.jsx(z,{router:e})}const A=Y.getInstance(),oe=D.getInstance();A.ready(()=>{H.createRoot(document.getElementById("popup")).render(s.jsx(W.StrictMode,{children:s.jsx(ae,{store:A,config:oe})}))});
