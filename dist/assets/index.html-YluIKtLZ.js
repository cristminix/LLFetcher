var S=Object.defineProperty;var b=(i,n,e)=>n in i?S(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e;var r=(i,n,e)=>(b(i,typeof n!="symbol"?n+"":n,e),e);import{a as x,D as v,B as M,S as w}from"./font-awesome.min-TSCjFFnw.js";import{r as j,s as A,j as o,b as T,R as P}from"./index-H9g6PPaV.js";class C extends j.Component{constructor(){super(...arguments);r(this,"commandListener",(e,t)=>{this.onMessageCommand(e,t)})}async sendMessageAsync(e,t,s="content"){return new Promise((a,c)=>{const l=(u,h)=>{chrome.runtime.onMessage.removeListener(l),a([u,h])};try{chrome.runtime.onMessage.addListener(l),A(e,t,s)}catch(u){c(u)}})}async getFromMessage(e,t,s){const[a,c]=await this.sendMessageAsync(e,t,s);return a.name===e?a.data:null}async onMessageCommand(e,t){}onMessage(){try{chrome.runtime.onMessage.removeListener(this.commandListener),chrome.runtime.onMessage.addListener(this.commandListener)}catch(e){console.log(e)}}initMessaging(){this.onMessage()}}class F extends C{constructor(e){super(e);r(this,"mApp",null);r(this,"mCourse",null);r(this,"mAuthor",null);r(this,"store",null);r(this,"courseAuthors",[]);const{store:t}=e;this.store=t,this.mApp=t.get("App"),this.mCourse=t.get("Course"),this.mAuthor=t.get("Author"),this.state={greeting:"LLFetcher 3.0+",lastCourseList:{},fetchBtnState:0,loading:!1,courseInfo:null,validCoursePage:!1,disableFetchBtn:!1,isLogin:!1}}async addToLastCourseList(e){this.setState({courseInfo:e});const t=e.slug,s=await this.createCourse(e);Object.keys(this.state.lastCourseList).includes(t)||this.populateLastCourseList(),await this.props.onSelectCourse(s,this.courseAuthors)}onMessageCommand(e,t){e.name==="cmd.validCoursePageAuto"&&this.setState({validCoursePage:e.data})}populateLastCourseList(){const e=this.mCourse.getList();let t={};for(let s in e)t[e[s].slug]=e[s];this.setState({lastCourseList:t})}async componentDidMount(){this.populateLastCourseList(),this.initMessaging(),await this.getValidCourseMessage()}async getValidCourseMessage(){const e="cmd.validCoursePage",t=await this.getFromMessage(e);this.setState({validCoursePage:t})}async getIsLoginMessage(){const e="cmd.isLogin",t=await this.getFromMessage(e);this.seState({isLogin:t})}async getCourseInfoMessage(){const e="cmd.getCourseInfo";this.setState({fetchBtnState:1});const t=await this.getFromMessage(e);await this.addToLastCourseList(t)}async getCurrentTabUrl(){return new Promise((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},function(s){let c=s[0].url;e(c)})})}async activateAddCourseOptionTab(e){const t="src/option-pages/",s=chrome.runtime.getURL(`${t}options.html#/course/add/${e}`);(await chrome.tabs.query({url:`${chrome.runtime.getURL("options.html")}*`})).length>0?chrome.runtime.sendMessage({action:"activateTab",url:s,optionPageBaseUrl:t}):chrome.tabs.create({url:s})}async addCourseFromCurrentUrl(){const t=(await this.getCurrentTabUrl()).replace("https://www.linkedin.com/learning/","").split("/")[0];this.activateAddCourseOptionTab(t)}async onSelectCourse(e){this.activateAddCourseOptionTab(e)}render(){const{isLogin:e,greeting:t,lastCourseList:s,fetchBtnState:a,validCoursePage:c,loading:l,disableFetchBtn:u}=this.state,h=Object.keys(s),L=a==0?"fa-plus":a==1?"fa-spin fa-spinner":a==2?"fa-refresh":"fa-hand-o-right",g=h.map(m=>{const d=s[m],f=d.slug,y=d.title;return{value:f,text:y}});return o.jsx(o.Fragment,{children:o.jsxs("div",{className:"welcome-page page gap-2 flex flex-col items-center",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("div",{children:o.jsx("img",{src:x})}),o.jsx("div",{children:o.jsx("p",{className:"font-bold pt-2 pb-4 text-center",style:{fontFamily:"Monoton, cursive"},children:t})})]}),o.jsxs("div",{className:"action-cnt",children:[g.length>0?o.jsx(o.Fragment,{children:o.jsx(v,{data:g,selected:"Load Last Course",onSelect:m=>this.onSelectCourse(m)})}):"",o.jsx("div",{className:"btn-cnt",children:o.jsx(M,{disabled:a==1||!c||u,className:"btn btn-primary",onClick:m=>this.addCourseFromCurrentUrl(),icon:`fa ${L}`,caption:"Add This Course"})}),o.jsx("div",{className:"p-4"})]})]})})}}class N extends C{constructor(e){super(e);r(this,"store",null);r(this,"mApp",null);r(this,"mAuthor",null);r(this,"mSection",null);r(this,"mToc",null);r(this,"mCourse",null);const{store:t}=e;this.store=t,this.mApp=t.get("App"),this.mAuthor=t.get("Author"),this.mSection=t.get("Section"),this.mToc=t.get("Toc"),this.mCourse=t.get("Course"),this.state={course:null,courseAuthors:null,courseSectionInfoStr:"[]",courseSectionStr:"[]",courseTocsStr:"[]",nav:"welcome"}}onNavUpdate(e){this.setState({nav:e})}async loadCourseSections(){if(console.log("Popup.createCourseSections() empty csi "),console.log("try to load from database "),this.state.course){const e=this.mSection.getList(this.state.course.id);let t={};for(let s in e){const a=e[s];t[a.slug]=this.mToc.getListBySectionId(a.id)}await this.updateCourseData(e,t)}}async activateOptionTab(e){const t=chrome.runtime.getURL(`options.html#/manager/${e}`);(await chrome.tabs.query({url:`${chrome.runtime.getURL("options.html")}*`})).length>0?chrome.runtime.sendMessage({action:"activateTab",url:t}):chrome.tabs.create({url:t}),setTimeout(a=>window.close(),100)}async updateCourseData(e,t){const s=JSON.stringify(e),a=JSON.stringify(t);this.setState({courseSectionStr:s,courseTocsStr:a},async()=>{this.state.course.slug!==""&&(await this.mCourse.setLastSlug(this.state.course.slug),this.setState({nav:"course"},()=>{const{course:c,sections:l,tocs:u}=this.state;console.log(c,l,u)}),this.activateOptionTab(this.state.course.slug))})}}class U extends N{constructor(n){super(n)}async onSelectCourse(n){console.log(n)}componentDidMount(){}render(){const{store:n}=this;return o.jsx("div",{className:"app-container w-[300px] py-4 px-2 dark:bg-gray-700 dark:text-gray-200",children:o.jsx(F,{store:n})})}}const p=w.getInstance();p.ready(()=>{T.createRoot(document.getElementById("popup")).render(o.jsx(P.StrictMode,{children:o.jsx(U,{store:p})}))});
